---
import "../styles/global.css";
import Footer from "../components/Footer.astro";
import { SEO } from "astro-seo";
import ScrollToTop from "../components/ScrollToTop.astro";

interface Props {
  title: string;
  description?: string;
  image?: string;
  articleDate?: string;
  showBackgroundEffects?: boolean;
}

const {
  title,
  description = "Uzman Fizyoterapist ile sağlıklı bir yaşama adım atın. Pediatrik rehabilitasyon ve duyu bütünleme terapisi.",
  image = "/og-image.jpg",
  articleDate,
  showBackgroundEffects = true,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

// Fetch Site Settings (Dynamic SEO)
import { pb } from "../lib/pocketbase";
let siteSettings = {
  phone: "+905555555555",
  email: "ezgiacem97@gmail.com",
  address: "İstanbul, Türkiye",
  social_links: {},
};

try {
  const settings = await pb.collection("site_settings").getFirstListItem("");
  if (settings) {
    siteSettings = {
      ...siteSettings,
      ...settings,
      email: settings.contact_email || siteSettings.email,
    };
  }
} catch (e) {
  // Fallback to defaults if collection doesn't exist or is empty
  console.log("Site settings not found, using defaults.");
}
---

<!doctype html>
<html lang="tr" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- Google Fonts: Nunito (Better Turkish Support) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <SEO
      title={title}
      description={description}
      canonical={canonicalURL.toString()}
      openGraph={{
        basic: {
          title: title,
          type: articleDate ? "article" : "website",
          image: new URL(image, Astro.url).toString(),
        },
        optional: {
          description: description,
        },
      }}
      twitter={{
        card: "summary_large_image",
        title: title,
        description: description,
        image: new URL(image, Astro.url).toString(),
      }}
      extend={{
        meta: articleDate
          ? [{ property: "article:published_time", content: articleDate }]
          : [],
      }}
    />

    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Physician",
        name: "Fizyoterapist Ezgi Acem",
        image: "https://fizyoterapist-demo.com/og-image.jpg",
        "@id": "https://fizyoterapist-demo.com",
        url: "https://fizyoterapist-demo.com",
        telephone: siteSettings.phone,
        email: siteSettings.email,
        address: {
          "@type": "PostalAddress",
          addressLocality: "İstanbul",
          addressCountry: "TR",
          streetAddress: siteSettings.address,
        },
        openingHoursSpecification: [
          {
            "@type": "OpeningHoursSpecification",
            dayOfWeek: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
            opens: "09:00",
            closes: "18:00",
          },
          {
            "@type": "OpeningHoursSpecification",
            dayOfWeek: "Saturday",
            opens: "10:00",
            closes: "15:00",
          },
        ],
      })}
    />
    <link rel="apple-touch-icon" href="/logo.svg" />
    <link rel="apple-touch-icon" href="/logo.svg" />
    <style is:global>
      :root {
        --color-primary: #ff8a65; /* Soft Orange */
        --color-secondary: #4dd0e1; /* Cyan */
        --color-tertiary: #aed581; /* Light Green */
        --color-text: #455a64; /* Blue Grey */
        --bg-soft: #fff3e0; /* Very light orange/cream */
      }
      body {
        font-family: "Nunito", sans-serif;
      }
    </style>
  </head>
  <body
    class="bg-[#FAFAFA] text-slate-700 antialiased min-h-dvh flex flex-col relative overflow-x-hidden selection:bg-orange-200 selection:text-orange-900"
  >
    <!-- Global Ambient Background (Static & Performant) -->
    {
      showBackgroundEffects && (
        <div
          class="fixed inset-0 z-[-1] pointer-events-none"
          style="background: 
                radial-gradient(circle at 15% 5%, rgba(255, 138, 101, 0.05), transparent 40%),
                radial-gradient(circle at 85% 30%, rgba(77, 208, 225, 0.05), transparent 40%),
                radial-gradient(circle at 0% 90%, rgba(174, 213, 129, 0.05), transparent 40%);"
        />
      )
    }
    <header
      class="fixed top-6 left-1/2 -translate-x-1/2 z-[100] w-[95%] md:w-full md:max-w-5xl transition-all duration-300"
    >
      <div
        class="bg-white/90 backdrop-blur-md border border-white/40 shadow-xl rounded-full px-6 py-3 flex items-center justify-between"
      >
        <!-- Logo -->
        <a
          href="/"
          class="font-extrabold text-xl tracking-tight text-slate-700 flex items-center gap-1 group"
          aria-label="Fizyoterapist Ezgi Acem Ana Sayfa"
        >
          <span
            class="w-8 h-8 md:w-12 md:h-12 flex items-center justify-center group-hover:rotate-12 transition-transform filter drop-shadow-md"
          >
            <img
              src="/logo.svg"
              alt="Fzt Ezgi Acem Logo"
              class="w-full h-full object-contain"
            />
          </span>
          <span class="whitespace-nowrap"
            >Fzt. Ezgi <span class="text-[#FF8A65]">ACEM</span></span
          >
        </a>

        <!-- Desktop Nav -->
        <nav class="hidden md:flex items-center gap-1">
          <a
            href="/"
            class="px-4 py-2 text-base font-medium text-slate-600 hover:text-[#FF8A65] rounded-full hover:bg-orange-50 transition-colors"
            >Ana Sayfa</a
          >
          <a
            href="/blog"
            class="px-4 py-2 text-base font-medium text-slate-600 hover:text-[#FF8A65] rounded-full hover:bg-orange-50 transition-colors"
            >Yazılar</a
          >
          <a
            href="/hakkimda"
            class="px-4 py-2 text-base font-medium text-slate-600 hover:text-[#FF8A65] rounded-full hover:bg-orange-50 transition-colors"
            >Biyografi</a
          >
          <a
            href="/uzmanlik-alanlarim"
            class="px-4 py-2 text-base font-medium text-slate-600 hover:text-[#FF8A65] rounded-full hover:bg-orange-50 transition-colors"
            >Uzmanlık Alanlarım</a
          >
          <a
            href="/iletisim"
            class="px-4 py-2 text-base font-medium text-slate-600 hover:text-[#FF8A65] rounded-full hover:bg-orange-50 transition-colors"
            >İletişim</a
          >
        </nav>

        <!-- Mobile Menu Toggle (CSS-Only Checkbox Hack) -->
        <label
          class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-full transition-colors cursor-pointer select-none"
        >
          <input type="checkbox" class="peer hidden" id="mobileMenuCheckbox" />

          <!-- Hamburger Icon -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="peer-checked:hidden"
          >
            <line x1="3" x2="21" y1="6" y2="6"></line>
            <line x1="3" x2="21" y1="12" y2="12"></line>
            <line x1="3" x2="21" y1="18" y2="18"></line>
          </svg>

          <!-- Close Icon (Shown when checked) -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="hidden peer-checked:block"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>

          <!-- Mobile Menu Dropdown -->
          <div
            class="absolute top-full left-0 w-full mt-2 p-2 hidden peer-checked:block animate-in fade-in slide-in-from-top-2 duration-200"
          >
            <nav
              class="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-orange-100 overflow-hidden flex flex-col p-2"
            >
              <a
                href="/"
                class="p-3 rounded-xl text-slate-700 hover:bg-orange-50 hover:text-[#FF8A65] font-medium transition-colors"
                >Ana Sayfa</a
              >
              <a
                href="/blog"
                class="p-3 rounded-xl text-slate-700 hover:bg-orange-50 hover:text-[#FF8A65] font-medium transition-colors"
                >Yazılar</a
              >
              <a
                href="/hakkimda"
                class="p-3 rounded-xl text-slate-700 hover:bg-orange-50 hover:text-[#FF8A65] font-medium transition-colors"
                >Biyografi</a
              >
              <a
                href="/uzmanlik-alanlarim"
                class="p-3 rounded-xl text-slate-700 hover:bg-orange-50 hover:text-[#FF8A65] font-medium transition-colors"
                >Uzmanlık Alanlarım</a
              >
              <a
                href="/iletisim"
                class="p-3 rounded-xl text-white bg-[#FF8A65] hover:bg-[#FF7043] font-bold text-center mt-2 shadow-lg shadow-orange-200"
                >Randevu Al</a
              >
            </nav>
          </div>
        </label>
      </div>
    </header>

    <main class="flex-1 w-full">
      <slot />
    </main>

    <Footer />
    <ScrollToTop />
  </body>
</html>

<style is:global>
  @keyframes blob {
    0% {
      transform: translate(0px, 0px) scale(1);
    }
    33% {
      transform: translate(30px, -50px) scale(1.1);
    }
    66% {
      transform: translate(-20px, 20px) scale(0.9);
    }
    100% {
      transform: translate(0px, 0px) scale(1);
    }
  }
  .animate-blob {
    animation: blob 7s infinite;
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
  }
  .animation-delay-2000 {
    animation-delay: 2s;
  }
  .animation-delay-4000 {
    animation-delay: 4s;
  }
</style>
