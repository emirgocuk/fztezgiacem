---
import BaseLayout from "../layouts/BaseLayout.astro";
import { pb } from "../lib/pocketbase";

const description =
    "Otizm, Hiperaktivite, Duyu Bütünleme ve daha fazlası üzerine fizyoterapi temelli yaklaşımlar.";

let specializations: any[] = [];
try {
    // Simple fetch without sort to avoid indexing errors
    specializations = await pb.collection("specializations").getFullList();
} catch (e: any) {
    console.error("Uzmanlık alanları getirilemedi (SSR):", e.status, e.message);
}
---

<BaseLayout title="Uzmanlık Alanlarım" description={description}>
    <!-- Full Width Background Wrapper -->
    <div
        class="w-full min-h-screen relative overflow-hidden bg-gradient-to-b from-orange-50/50 to-orange-50"
    >
        <!-- Decorative background elements -->
        <div
            class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none"
        >
            <div
                class="absolute top-[-10%] right-[-5%] w-96 h-96 bg-yellow-200/40 rounded-full blur-3xl animate-blob"
            >
            </div>
            <div
                class="absolute bottom-[-10%] left-[-5%] w-96 h-96 bg-blue-200/40 rounded-full blur-3xl animate-blob animation-delay-2000"
            >
            </div>
            <div
                class="absolute top-[40%] right-[20%] w-64 h-64 bg-green-200/30 rounded-full blur-3xl animate-blob animation-delay-4000"
            >
            </div>
        </div>

        <section
            class="max-w-7xl mx-auto px-6 pt-32 pb-12 flex flex-col items-center justify-center relative overflow-visible"
        >
            <h1
                class="text-3xl md:text-4xl font-black text-[#1E3A1A] text-center mb-4"
            >
                Uzmanlık Alanlarım
            </h1>
            <p
                class="text-slate-600 text-center max-w-3xl mb-6 leading-relaxed"
            >
                Çocukların gelişim yolculuğunda bilimsel temelli fizyoterapi
                yaklaşımları ve oyunun iyileştirici gücü.
            </p>

            <!-- Slider Container with Relative Positioning -->
            <div class="relative w-full max-w-5xl mx-auto">
                <main
                    id="cardSlider"
                    class="cards-wrapper relative w-full gap-6 flex md:grid md:grid-cols-3 place-items-center py-4"
                >
                    {
                        specializations.map((item) => (
                            <a
                                href={`/uzmanlik-alanlarim/${item.slug || item.id}`}
                                class="cards block relative overflow-hidden group"
                                style={`background-image: url('${item.image || "https://img.freepik.com/free-photo/kids-playing-grass_1098-13838.jpg"}')`}
                            >
                                <div class="absolute inset-0 bg-black/20 group-hover:bg-black/0 transition-colors duration-300 pointer-events-none" />

                                <div class="card-title absolute bottom-0 left-0 right-0 bg-black/60 text-white p-3 text-center text-sm font-bold rounded-b-xl backdrop-blur-sm transition-opacity duration-300">
                                    {item.title}
                                </div>
                            </a>
                        ))
                    }
                </main>

                <!-- Mobile Slider Navigation Arrows -->
                <div
                    class="absolute inset-x-0 top-1/2 -translate-y-1/2 flex justify-between px-4 md:hidden pointer-events-none z-20"
                >
                    <button
                        id="btnLeft"
                        class="bg-white/90 p-3 rounded-full shadow-xl text-slate-700 hover:text-orange-500 hover:scale-110 active:scale-95 transition-all outline-none pointer-events-auto cursor-pointer"
                        aria-label="Sola Kaydır"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            ><path d="M15 18l-6-6 6-6"></path></svg
                        >
                    </button>
                    <button
                        id="btnRight"
                        class="bg-white/90 p-3 rounded-full shadow-xl text-slate-700 hover:text-orange-500 hover:scale-110 active:scale-95 transition-all outline-none pointer-events-auto cursor-pointer"
                        aria-label="Sağa Kaydır"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            ><path d="M9 18l6-6-6-6"></path></svg
                        >
                    </button>
                </div>
            </div>

            <p class="text-center text-gray-400 mt-12 text-sm">
                Detaylar için kartların üzerine tıklayabilirsiniz.
            </p>
        </section>
    </div>
</BaseLayout>

<style>
    /* 
     * Simplified Native Layout
     * No Radio Buttons, No Hacky Animations
     */

    .cards-wrapper {
        perspective: 1000px;
    }

    .cards {
        width: 100%;
        aspect-ratio: 3/4.2;
        /* Removed fixed min/max widths that conflict with grid */
        background: center / cover no-repeat;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        border-radius: 16px;
        transform: translateZ(0); /* Hardware accelerate */
        transition:
            transform 0.3s ease,
            box-shadow 0.3s ease;
        text-decoration: none;
    }

    /* Desktop Hover Effect Only */
    @media (min-width: 769px) {
        .cards:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .cards-wrapper {
            flex-direction: row;
            flex-wrap: nowrap; /* Horizontal Scroll */
            overflow-x: auto;
            justify-content: flex-start;
            padding: 10px 20px 30px 20px; /* Space for shadow */
            scroll-snap-type: x mandatory;
            gap: 15px;
            -webkit-overflow-scrolling: touch; /* iOS Momentum Scroll */
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        .cards-wrapper::-webkit-scrollbar {
            display: none; /* Hide scrollbar Chrome/Safari */
        }

        .cards {
            width: 60vw; /* Wider cards on mobile for better visibility */
            min-width: 200px;
            flex-shrink: 0;
            scroll-snap-align: center;
        }

        /* 
           Crucial for iOS "Flicker" fix: 
           Remove all hover/focus states that might trigger layout shifts 
        */
        .cards:active,
        .cards:focus {
            opacity: 0.9;
            transform: scale(0.98); /* Subtle tap feedback */
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const slider = document.getElementById("cardSlider");
        const btnLeft = document.getElementById("btnLeft");
        const btnRight = document.getElementById("btnRight");

        if (slider && btnLeft && btnRight) {
            btnLeft.addEventListener("click", () => {
                const scrollAmount = window.innerWidth * 0.6; // Scroll 60% of screen width
                slider.scrollBy({ left: -scrollAmount, behavior: "smooth" });
            });

            btnRight.addEventListener("click", () => {
                const scrollAmount = window.innerWidth * 0.6;
                slider.scrollBy({ left: scrollAmount, behavior: "smooth" });
            });
        }
    });
</script>
