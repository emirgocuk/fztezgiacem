import{p}from"./pocketbase.DxbRfAQo.js";import{u as w}from"./imgbb.Dz0VKEpx.js";import"./pocketbase.es.B4ZgO_7c.js";const f={ç:"c",ğ:"g",ş:"s",ü:"u",ö:"o",ı:"i",Ç:"c",Ğ:"g",Ş:"s",Ü:"u",Ö:"o",İ:"i"},I=new URLSearchParams(window.location.search),i=I.get("id"),d=document.getElementById("postForm"),h=document.getElementById("loadingState");let t;i||(alert("Hata: Yazı ID bulunamadı."),window.location.href="/admin");async function b(){try{if(!i)return;if(t=await p.collection("posts").getOne(i),document.getElementById("postId").value=t.id,document.querySelector('input[name="title"]').value=t.title,document.querySelector('input[name="slug"]').value=t.slug,document.querySelector('select[name="category"]').value=t.category||"Genel",document.querySelector('textarea[name="summary"]').value=t.summary||"",t.published_date&&(document.querySelector('input[name="published_date"]').value=new Date(t.published_date).toISOString().split("T")[0]),t.image){const a=setInterval(()=>{window.dispatchEvent(new CustomEvent("set-initial-image",{detail:t.image}))},500);setTimeout(()=>clearInterval(a),3e3)}const o=t.content||"",n=setInterval(()=>{const a=new CustomEvent("set-tiptap-content",{detail:o});window.dispatchEvent(a)},500);setTimeout(()=>clearInterval(n),3e3),document.getElementById("contentHidden").value=o,h?.classList.add("hidden"),d?.classList.remove("hidden")}catch(o){alert("Yazı yüklenirken hata: "+o.message),window.location.href="/admin"}}b();document.querySelector('input[name="title"]')?.addEventListener("input",o=>{let a=o.target.value.split("").map(e=>f[e]||e).join("").toLowerCase();a=a.replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");const l=document.querySelector('input[name="slug"]');l&&(l.value=a)});d?.addEventListener("submit",async o=>{o.preventDefault();const n=document.getElementById("submitBtn"),a=n.innerText,l=document.getElementById("contentHidden");try{n.disabled=!0,n.innerText="Güncelleniyor...";const e=new FormData(d);let s="";const r=e.get("cropped_image");if(r&&r.startsWith("data:image")){n.innerText="Görsel Yükleniyor...";const y=await(await fetch(r)).blob(),v=new File([y],"cover_image.jpg",{type:"image/jpeg"});s=await w(v)}let u="",m=e.get("published_date");if(m){let c=new Date(m);isNaN(c.getTime())||(u=c.toISOString())}const g={title:e.get("title"),slug:e.get("slug"),category:e.get("category"),summary:e.get("summary"),published_date:u||null,content:l.value};if(s&&(g.image=s),!i)throw new Error("ID Missing");await p.collection("posts").update(i,g),alert("Güncelleme başarılı!"),window.location.href="/admin"}catch(e){console.error(e),alert("Hata: "+e.message)}finally{n.disabled=!1,n.innerText=a}});
